<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Resumen Egresos</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header class="row wrap" style="justify-content:space-between">
  <nav>
    <a href="/">Inicio</a>
    <a href="/egresos">Egresos</a>
    <a href="/egresos/nuevo">+ Egreso</a>
  </nav>
</header>

<main class="wrap">
  <h1>Resumen de egresos</h1>
  <div id="cards" class="row"></div>
  <table id="tbl">
    <thead><tr><th>Categoría</th><th>Monto</th><th>Monto real</th></tr></thead>
    <tbody></tbody>
  </table>
</main>

<script src="/static/script.js"></script>
<script>
(async ()=>{
  const r = await fetch('/api/egresos'); const data = await r.json();
  let total = 0, totalReal=0; const byCat = new Map();
  data.rows.forEach(x=>{
    const c = Number(x.CANTIDAD)||0, cr = Number(x.CANTIDAD_REAL)||0;
    total += c; totalReal += cr;
    const k = x.CATEGORIA; const v = byCat.get(k)||{c:0,cr:0};
    v.c += c; v.cr += cr; byCat.set(k,v);
  });

  document.getElementById('cards').append(
    el('div',{class:'badge'},'Bruto: $ '+fmtCOP(total)),
    el('div',{class:'badge'},'Real: $ '+fmtCOP(totalReal)),
    el('div',{class:'badge'},'Registros: '+data.rows.length)
  );

  const tb=document.querySelector('#tbl tbody');
  Array.from(byCat.entries()).sort().forEach(([k,v])=>{
    tb.append(el('tr',{}, el('td',{html:k||'(vacío)'}),
                        el('td',{html:fmtCOP(v.c)}),
                        el('td',{html:fmtCOP(v.cr)})));
  });
})();
</script>
</body>
</html>
