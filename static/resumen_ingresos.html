<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Resumen Ingresos</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header class="row wrap" style="justify-content:space-between">
  <nav>
    <a href="/">Inicio</a>
    <a href="/ingresos">Ingresos</a>
    <a href="/ingresos/nuevo">+ Ingreso</a>
  </nav>
</header>

<main class="wrap">
  <h1>Resumen de ingresos</h1>
  <div id="cards" class="row"></div>
  <table id="tbl">
    <thead><tr><th>Semestre</th><th>Monto</th></tr></thead>
    <tbody></tbody>
  </table>
</main>

<script src="/static/script.js"></script>
<script>
(async ()=>{
  const r = await fetch('/api/ingresos'); const data = await r.json();
  let total = 0; const bySem = new Map();
  data.rows.forEach(x=>{
    total += Number(x.CANTIDAD)||0;
    const k = x.SEMESTRE; bySem.set(k, (bySem.get(k)||0) + (Number(x.CANTIDAD)||0));
  });

  document.getElementById('cards').append(
    el('div',{class:'badge'},'Total: $ '+fmtCOP(total)),
    el('div',{class:'badge'},'Registros: '+data.rows.length)
  );

  const tb=document.querySelector('#tbl tbody');
  Array.from(bySem.entries()).sort().forEach(([k,v])=>{
    tb.append(el('tr',{}, el('td',{html:k||'(vac√≠o)'}), el('td',{html:fmtCOP(v)})));
  });
})();
</script>
</body>
</html>
